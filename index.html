<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kumacho Movie App</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .table-container {
            max-height: 55vh; 
            overflow-y: auto;
        }
        th, td {
            padding: 0.75rem;
            text-align: left; 
            border-bottom-width: 1px;
        }
        th {
            background-color: #f3f4f6; /* bg-gray-100 */
            position: sticky;
            top: 0;
            z-index: 10; 
        }
        .table-container::-webkit-scrollbar {
            width: 8px;
        }
        .table-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .table-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .table-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        #searchInput:focus {
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5); 
        }
        .clickable-title {
            color: #4f46e5; 
            text-decoration: underline;
            cursor: pointer;
        }
        .clickable-title:hover {
            color: #3730a3; 
        }
        .modal {
            transition: opacity 0.3s ease-in-out;
            z-index: 50; 
        }
        .modal-content {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            max-height: 90vh; 
            overflow-y: auto;
        }
        #recommendationModal iframe {
            width: 100%;
            height: 70vh;
            border: none;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db; /* Blue */
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .faq-question {
            font-weight: 600; 
            color: #1f2937; 
            margin-top: 0.75rem; 
        }
        .faq-answer {
            color: #4b5563; 
            margin-bottom: 0.75rem; 
            font-size: 0.875rem; 
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-800 antialiased">
    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="mb-6 text-center">
            <h1 class="text-3xl sm:text-4xl font-bold text-indigo-600">Kumacho Movie App</h1>
            <p class="text-gray-600 mt-2">Browse and search your curated lists of Movies, TV Shows, Cartoons, and Anime.</p>
            <div class="mt-4 space-x-2">
                <button id="openRecommendationModalButton" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-105">
                    Suggest a Recommendation
                </button>
                <button id="openFaqModalButton" class="bg-sky-500 hover:bg-sky-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-105">
                    FAQ / Help
                </button>
            </div>
        </header>

        <div class="mb-6 flex flex-wrap justify-center gap-2 sm:gap-3">
            <button data-list="movies" class="list-btn bg-indigo-500 hover:bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-105">Movies</button>
            <button data-list="tvshows" class="list-btn bg-teal-500 hover:bg-teal-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-105">TV Shows</button>
            <button data-list="cartoons" class="list-btn bg-amber-500 hover:bg-amber-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-105">Cartoons</button>
            <button data-list="anime" class="list-btn bg-rose-500 hover:bg-rose-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out transform hover:scale-105">Anime</button>
        </div>

        <div class="mb-6">
            <input type="text" id="searchInput" placeholder="Search current list (e.g., title, genre, year)..." class="w-full p-3 border border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:ring-indigo-500">
        </div>

        <div id="listContainer" class="bg-white p-4 sm:p-6 rounded-xl shadow-xl">
            <h2 id="listTitle" class="text-2xl font-semibold mb-4 text-gray-700">Select a category to view</h2>
            <div class="table-container rounded-lg border border-gray-200">
                <table id="mediaTable" class="min-w-full divide-y divide-gray-200">
                    <thead id="tableHead"></thead>
                    <tbody id="tableBody" class="bg-white divide-y divide-gray-200">
                        <tr><td id="initialMessageCell" class="text-center text-gray-500 py-4" colspan="4">No list selected. Please choose a category above.</td></tr>
                    </tbody>
                </table>
            </div>
             <p id="itemCount" class="text-sm text-gray-500 mt-4 text-right"></p>
        </div>
    </div>

    <div id="detailsModal" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center hidden p-4 opacity-0">
        <div class="modal-content relative mx-auto p-6 border w-full max-w-md shadow-xl rounded-xl bg-white transform scale-95 opacity-0">
            <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                <h3 class="text-xl leading-6 font-medium text-gray-900" id="modalTitle">Item Details</h3>
                <button id="closeModalButton" class="text-gray-400 hover:text-gray-600 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="mt-4">
                <div id="modalBody" class="text-sm text-gray-700 space-y-2"></div>
            </div>
            <div class="mt-6 pt-3 border-t border-gray-200 text-right">
                <button id="modalCloseButtonFooter" class="px-4 py-2 bg-indigo-500 text-white text-base font-medium rounded-lg shadow-sm hover:bg-indigo-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 transition">
                    Close
                </button>
            </div>
        </div>
    </div>

    <div id="recommendationModal" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center hidden p-4 opacity-0">
        <div class="modal-content relative mx-auto p-6 border w-full max-w-2xl shadow-xl rounded-xl bg-white transform scale-95 opacity-0">
            <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                <h3 class="text-xl leading-6 font-medium text-gray-900">Suggest a Recommendation</h3>
                <button id="closeRecommendationModalButton" class="text-gray-400 hover:text-gray-600 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="mt-4">
                <iframe id="recommendationFormIframe" frameborder="0" marginheight="0" marginwidth="0">Loadingâ€¦</iframe>
            </div>
            <div class="mt-6 pt-3 border-t border-gray-200 text-right">
                <button id="recommendationModalCloseButtonFooter" class="px-4 py-2 bg-green-500 text-white text-base font-medium rounded-lg shadow-sm hover:bg-green-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition">
                    Close
                </button>
            </div>
        </div>
    </div>

    <div id="faqModal" class="modal fixed inset-0 bg-gray-800 bg-opacity-75 flex items-center justify-center hidden p-4 opacity-0">
        <div class="modal-content relative mx-auto p-6 border w-full max-w-lg shadow-xl rounded-xl bg-white transform scale-95 opacity-0">
            <div class="flex justify-between items-center pb-3 border-b border-gray-200">
                <h3 class="text-xl leading-6 font-medium text-gray-900">FAQ / Help</h3>
                <button id="closeFaqModalButton" class="text-gray-400 hover:text-gray-600 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div id="faqModalBody" class="mt-4 space-y-4 text-left">
                <div>
                    <p class="faq-question">Why isn't data loading from the CSV links (e.g., "No movies found...")?</p>
                    <p class="faq-answer">This usually happens for one of these reasons:
                        <br>1. <strong>CORS Policy (if running locally):</strong> When you open this HTML file directly from your computer (`file:///...`), browsers block requests to external sites (like Google Sheets) for security.
                        <br>&nbsp;&nbsp;&nbsp;<strong>Solution:</strong> Run this HTML file through a local web server (e.g., using Python's `http.server`). The FAQ button provides more details.
                        <br>2. <strong>Network Issue:</strong> Check your internet connection.
                        <br>3. <strong>CSV Link Incorrect/Private:</strong> Ensure your Google Sheet is "Published to the web" as a CSV, and "Anyone with the link can view." Double-check the link in the app's code.
                        <br>4. <strong>Empty or Malformed CSV:</strong> The CSV file itself might be empty or not formatted correctly. For the "Movies" list, if it doesn't have a "Titles" header in the first row, the app tries to treat each line as a title. For other lists, a header row is expected.</p>
                </div>
                <div>
                    <p class="faq-question">Why does a pop-up sometimes just show a grey screen without content?</p>
                    <p class="faq-answer">This can be a browser rendering timing issue. The code tries to prevent this. If it happens, a page refresh might help. Also, ensure the data for the item you clicked is actually loading correctly.</p>
                </div>
                </div>
            <div class="mt-6 pt-3 border-t border-gray-200 text-right">
                <button id="faqModalCloseButtonFooter" class="px-4 py-2 bg-sky-500 text-white text-base font-medium rounded-lg shadow-sm hover:bg-sky-600 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-sky-500 transition">
                    Close
                </button>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration ---
        const CSV_URLS = {
            movies: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTeW7g2d80vRYYW84HsaltNDkQgzvkfcSqUR3z-Z2W2AaKWVtSVJazBvfTnq3OXb0zZXcMapQJFCkZ9/pub?gid=0&single=true&output=csv",
            tvshows: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTeW7g2d80vRYYW84HsaltNDkQgzvkfcSqUR3z-Z2W2AaKWVtSVJazBvfTnq3OXb0zZXcMapQJFCkZ9/pub?gid=1290796578&single=true&output=csv",
            cartoons: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTeW7g2d80vRYYW84HsaltNDkQgzvkfcSqUR3z-Z2W2AaKWVtSVJazBvfTnq3OXb0zZXcMapQJFCkZ9/pub?gid=498269002&single=true&output=csv",
            anime: "https://docs.google.com/spreadsheets/d/e/2PACX-1vTeW7g2d80vRYYW84HsaltNDkQgzvkfcSqUR3z-Z2W2AaKWVtSVJazBvfTnq3OXb0zZXcMapQJFCkZ9/pub?gid=743139865&single=true&output=csv"
        };
        const RECOMMENDATION_FORM_URL = "https://forms.gle/chLrCD4QxEE23SPa8";

        // --- App State ---
        let allDataCache = { movies: null, tvshows: null, cartoons: null, anime: null };
        let currentListType = null;
        let currentHeaders = [];
        let currentListTitle = 'No list selected';

        // --- DOM Elements (cached for performance) ---
        const listButtons = document.querySelectorAll('.list-btn');
        const searchInput = document.getElementById('searchInput');
        const listTitleElement = document.getElementById('listTitle');
        const tableHeadElement = document.getElementById('tableHead');
        const tableBodyElement = document.getElementById('tableBody');
        const itemCountElement = document.getElementById('itemCount');
        const initialMessageCell = document.getElementById('initialMessageCell');
        
        const detailsModal = document.getElementById('detailsModal');
        const detailsModalContent = detailsModal.querySelector('.modal-content');
        const modalTitleElement = document.getElementById('modalTitle');
        const modalBodyElement = document.getElementById('modalBody');
        
        const recommendationModal = document.getElementById('recommendationModal');
        const recommendationModalContent = recommendationModal.querySelector('.modal-content');
        const recommendationFormIframe = document.getElementById('recommendationFormIframe');

        const faqModal = document.getElementById('faqModal');
        const faqModalContent = faqModal.querySelector('.modal-content');

        // --- Event Listeners ---
        document.addEventListener('DOMContentLoaded', () => {
            listButtons.forEach(button => {
                button.addEventListener('click', () => loadAndDisplayList(button.dataset.list, button));
            });
            searchInput.addEventListener('input', renderTable); 

            // Modal Close Handlers
            [detailsModal.querySelector('#closeModalButton'), detailsModal.querySelector('#modalCloseButtonFooter')].forEach(btn => btn.addEventListener('click', hideDetailsModal));
            detailsModal.addEventListener('click', (event) => { if (event.target === detailsModal) hideDetailsModal(); });

            document.getElementById('openRecommendationModalButton').addEventListener('click', showRecommendationModal);
            [recommendationModal.querySelector('#closeRecommendationModalButton'), recommendationModal.querySelector('#recommendationModalCloseButtonFooter')].forEach(btn => btn.addEventListener('click', hideRecommendationModal));
            recommendationModal.addEventListener('click', (event) => { if (event.target === recommendationModal) hideRecommendationModal(); });
            
            document.getElementById('openFaqModalButton').addEventListener('click', showFaqModal);
            [faqModal.querySelector('#closeFaqModalButton'), faqModal.querySelector('#faqModalCloseButtonFooter')].forEach(btn => btn.addEventListener('click', hideFaqModal));
            faqModal.addEventListener('click', (event) => { if (event.target === faqModal) hideFaqModal(); });
        });

        // --- Core Functions ---
        async function fetchCSVData(url, listTypeForParse) {
            console.log(`Fetching CSV from: ${url}`);
            try {
                const response = await fetch(url, { cache: "no-store" });
                if (!response.ok) {
                    const errorText = `HTTP error! Status: ${response.status}. URL: ${url}.`;
                    console.error(errorText);
                    if (window.location.protocol === "file:") {
                        console.warn("Fetching external resources from 'file://' protocol is often blocked by browser CORS policy. Try using a local web server.");
                    }
                    throw new Error(errorText);
                }
                const csvText = await response.text();
                console.log(`Successfully fetched CSV data from ${url}. Raw length: ${csvText.length}`);
                if (!csvText || csvText.trim() === "") {
                    console.warn(`CSV file from ${url} is empty or contains only whitespace.`);
                    return [];
                }
                return parseCSV(csvText, listTypeForParse); // Pass listType for specific parsing logic
            } catch (error) {
                console.error("Error in fetchCSVData for " + url, error);
                tableHeadElement.innerHTML = '';
                tableBodyElement.innerHTML = `<tr><td colspan="1" class="text-center text-red-600 font-semibold py-4">Error loading data for ${currentListTitle}: ${error.message}. Check console, ensure CSV link is public & correctly outputs CSV, and verify network. If running locally, use a web server.</td></tr>`;
                itemCountElement.textContent = '';
                return [];
            }
        }

        function parseCSV(csvText, listType) { // Added listType parameter
            console.log(`Parsing CSV for listType: ${listType}. First 100 chars: ${csvText.substring(0,100)}`);
            const lines = csvText.trim().split(/\r\n|\n/).filter(line => line.trim() !== '');
            
            if (lines.length === 0) {
                console.warn("CSV is effectively empty after trimming and filtering empty lines.");
                return [];
            }

            let headers;
            let dataLines;
            const isMovieList = listType === 'movies';

            if (isMovieList) {
                const firstLineContent = lines[0].trim().replace(/^"|"$/g, '');
                // If movie list CSV's first line is NOT "Titles" (case-insensitive) AND it doesn't contain a comma (likely single column of titles)
                if (firstLineContent.toLowerCase() !== 'titles' && !firstLineContent.includes(',')) {
                    console.log("Movie list CSV assumed headerless. Using 'titles' as implicit header.");
                    headers = ['titles']; // Use 'titles' to match expected key
                    dataLines = lines; 
                } else {
                    console.log("Movie list CSV has a header row (expected 'Titles', 'Year', etc.) or multiple columns.");
                    headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
                    dataLines = lines.slice(1);
                }
            } else {
                if (lines.length < 1) { 
                     console.warn(`CSV for ${listType} has no header line.`); return [];
                }
                headers = lines[0].split(',').map(h => h.trim().replace(/^"|"$/g, ''));
                dataLines = lines.slice(1);
            }
            
            console.log("Effective CSV Headers:", headers);
            const data = [];

            dataLines.forEach((line, lineIndex) => {
                if (!line.trim()) return;

                const values = [];
                let currentField = '';
                let inQuotes = false;
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    if (char === '"') {
                        if (inQuotes && j + 1 < line.length && line[j+1] === '"') {
                            currentField += '"'; j++; 
                        } else {
                            inQuotes = !inQuotes;
                        }
                    } else if (char === ',' && !inQuotes) {
                        values.push(currentField); currentField = '';
                    } else {
                        currentField += char;
                    }
                }
                values.push(currentField); 

                if (values.length === headers.length) {
                    const rowObject = {};
                    headers.forEach((header, index) => {
                        // For movies, if we implicitly set header to 'titles', use that.
                        const keyToUse = isMovieList && headers.length === 1 && headers[0] === 'titles' ? 'titles' : headerToKey(header);
                        rowObject[keyToUse] = values[index].trim().replace(/^"|"$/g, '');
                    });
                    data.push(rowObject);
                } else {
                    // Adjust line number for console warning if movies list was treated as headerless
                    const actualLineNumber = lineIndex + (isMovieList && headers[0] === 'titles' ? 1 : 2);
                    console.warn(`Skipping malformed CSV line ${actualLineNumber}: Expected ${headers.length} fields, got ${values.length}. Line: "${line}"`);
                }
            });
            console.log(`Parsed ${data.length} data rows for ${listType}.`);
            return data;
        }
        
        async function loadAndDisplayList(listType, buttonElement = null) {
            if (buttonElement) setActiveButton(buttonElement);
            currentListType = listType;
            setTableLoadingState(true);
            itemCountElement.textContent = ''; 

            console.log(`Loading data for: ${listType}`);
            const data = await fetchCSVData(CSV_URLS[listType], listType); 
            allDataCache[currentListType] = data; 
            
            switch (listType) {
                case 'movies':
                    currentHeaders = ['Titles']; // Display header will be "Titles"
                    currentListTitle = 'Movies';
                    break;
                case 'tvshows':
                    currentHeaders = ['Title', 'Genre(s)', 'Years Aired'];
                    currentListTitle = 'TV Shows';
                    break;
                case 'cartoons':
                    currentHeaders = ['Title', 'Genre(s)', 'Years Aired', 'Country of Origin'];
                    currentListTitle = 'Cartoons';
                    break;
                case 'anime':
                    currentHeaders = ['Title', 'Genre(s)', 'Years Aired', 'Content Rating'];
                    currentListTitle = 'Anime';
                    break;
            }
            setTableLoadingState(false); 
            renderTable(); 
        }
        
        function setTableLoadingState(isLoading) {
            if (isLoading) {
                tableHeadElement.innerHTML = '';
                tableBodyElement.innerHTML = `<tr><td colspan="1" class="text-center py-4"><div class="loader"></div><p class="text-gray-500">Loading data...</p></td></tr>`;
                if(initialMessageCell) initialMessageCell.style.display = 'none';
            } else {
                 if(initialMessageCell) initialMessageCell.style.display = 'none';
            }
        }

        function setActiveButton(activeBtn) {
            listButtons.forEach(btn => {
                btn.classList.remove('ring-2', 'ring-offset-2', 'ring-indigo-500', 'ring-teal-500', 'ring-amber-500', 'ring-rose-500');
                if (btn === activeBtn) {
                    btn.classList.add('ring-2', 'ring-offset-2');
                    const listType = btn.dataset.list;
                    if (listType === 'movies') btn.classList.add('ring-indigo-500');
                    else if (listType === 'tvshows') btn.classList.add('ring-teal-500');
                    else if (listType === 'cartoons') btn.classList.add('ring-amber-500');
                    else if (listType === 'anime') btn.classList.add('ring-rose-500');
                }
            });
        }
        
        function renderTable() {
            listTitleElement.textContent = currentListTitle;
            tableHeadElement.innerHTML = '';
            tableBodyElement.innerHTML = ''; 
            itemCountElement.textContent = '';
            if(initialMessageCell) initialMessageCell.style.display = 'none';

            if (!currentListType) {
                tableBodyElement.innerHTML = `<tr><td class="text-center text-gray-500 py-4" colspan="1">Select a category to view.</td></tr>`;
                return;
            }
            
            const dataForCurrentList = allDataCache[currentListType] || [];

            if (tableBodyElement.querySelector('.text-red-600')) {
                return; 
            }

            if (dataForCurrentList.length === 0) {
                const colSpan = currentHeaders.length > 0 ? currentHeaders.length : 1;
                tableBodyElement.innerHTML = `<tr><td colspan="${colSpan}" class="text-center text-gray-500 py-4">No ${currentListTitle.toLowerCase()} data found. Ensure CSV is populated, public, correctly formatted, and the link is valid.</td></tr>`;
                return;
            }
            
            const headerRow = tableHeadElement.insertRow();
            currentHeaders.forEach(headerText => {
                const th = document.createElement('th');
                th.className = 'px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider';
                th.textContent = headerText; // Use the display header text
                headerRow.appendChild(th);
            });

            const searchTerm = searchInput.value.toLowerCase();
            const filteredData = dataForCurrentList.filter(item => {
                if (!item || typeof item !== 'object') return false;
                if (!searchTerm) return true; 
                return currentHeaders.some(header => {
                    const key = headerToKey(header); 
                    const value = item[key] || ''; 
                    return String(value).toLowerCase().includes(searchTerm);
                });
            });
            
            itemCountElement.textContent = `Showing ${filteredData.length} of ${dataForCurrentList.length} items.`;

            if (filteredData.length > 0) {
                filteredData.forEach(item => {
                    if (!item || typeof item !== 'object') return; 
                    const row = tableBodyElement.insertRow();
                    currentHeaders.forEach(header => {
                        const cell = row.insertCell();
                        cell.className = 'px-4 py-3 whitespace-nowrap text-sm text-gray-700';
                        const key = headerToKey(header); 
                        const value = item[key] || '';
                        
                        // Make the content of the first column (usually Title/Titles) clickable
                        if (header === currentHeaders[0]) { 
                            cell.textContent = value;
                            cell.classList.add('clickable-title');
                            cell.onclick = () => showItemDetails(item);
                        } else {
                            cell.textContent = value;
                        }
                    });
                });
            } else {
                const colSpan = currentHeaders.length > 0 ? currentHeaders.length : 1;
                tableBodyElement.innerHTML = `<tr><td colspan="${colSpan}" class="text-center text-gray-500 py-4">No items match your search.</td></tr>`;
            }
        }

        function headerToKey(headerText) {
            if (!headerText) return '';
            return headerText.toLowerCase().replace(/[^a-z0-9]/gi, '');
        }
        
        function showModal(modalElement, modalContentElement) {
            modalElement.classList.remove('hidden');
            requestAnimationFrame(() => { 
                modalElement.classList.remove('opacity-0');
                modalContentElement.classList.remove('opacity-0', 'scale-95');
                modalContentElement.classList.add('opacity-100', 'scale-100');
            });
        }

        function hideModal(modalElement, modalContentElement, onHideCallback) {
            modalContentElement.classList.add('opacity-0', 'scale-95');
            modalContentElement.classList.remove('opacity-100', 'scale-100');
            modalElement.classList.add('opacity-0');
            setTimeout(() => {
                 modalElement.classList.add('hidden');
                 if (onHideCallback) onHideCallback();
            }, 300); 
        }

        function showItemDetails(item) {
            let displayTitle = "Details";
            // Determine the correct key for the title based on list type or common patterns
            if (currentListType === 'movies' && item.titles) { // 'titles' from movie CSV
                displayTitle = item.titles;
            } else if (item.title) { // 'title' for other lists
                displayTitle = item.title;
            } else if (Object.keys(item).length > 0) { // Fallback
                displayTitle = item[Object.keys(item)[0]];
            }
            modalTitleElement.textContent = displayTitle;
            modalBodyElement.innerHTML = ''; 

            for (const key in item) {
                if (Object.hasOwnProperty.call(item, key)) {
                    const value = item[key] || 'N/A';
                    const detailP = document.createElement('p');
                    let displayName = key.replace(/([A-Z0-9])/g, ' $1').replace(/^./, str => str.toUpperCase());
                    displayName = displayName.split(' ').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' '); 

                    detailP.innerHTML = `<strong class="font-semibold text-gray-600">${displayName}:</strong> ${value}`;
                    modalBodyElement.appendChild(detailP);
                }
            }
            showModal(detailsModal, detailsModalContent);
        }
        function hideDetailsModal() { hideModal(detailsModal, detailsModalContent); }

        function showRecommendationModal() {
            recommendationFormIframe.src = RECOMMENDATION_FORM_URL;
            showModal(recommendationModal, recommendationModalContent);
        }
        function hideRecommendationModal() { 
            hideModal(recommendationModal, recommendationModalContent, () => {
                recommendationFormIframe.src = "about:blank"; 
            });
        }

        function showFaqModal() { showModal(faqModal, faqModalContent); }
        function hideFaqModal() { hideModal(faqModal, faqModalContent); }

    </script>
</body>
</html>
```

I've updated the app on the Canvas. Here are the key changes:

1.  **Movie CSV Parsing Logic**:
    * The `parseCSV` function now has a special check when `isMovieList` is true (this flag is passed from `fetchCSVData` when fetching the movie list).
    * It examines the first line of the Movie CSV. If this line, after trimming and unquoting, is not exactly "title" (case-insensitive) AND it doesn't contain commas (suggesting it's a single column list where the first item might be a title itself), it will treat the entire CSV as a headerless list of titles. Each line will become an object like `{ title: "Actual Movie Title" }`.
    * If the Movie CSV *does* have a "Title" header, or multiple columns, it will be parsed normally like the other CSVs.
    * This makes the app more resilient to whether your Movie CSV has a "Title" header or is just a raw list of titles. **However, for best results and consistency, I still recommend ensuring your Movie CSV has "Title" as the header in its first row.**

2.  **Improved Modal Display**: The `showModal` and `hideModal` helper functions now use `requestAnimationFrame` more directly for applying transition classes after the `hidden` class is removed. This is a robust way to handle CSS transitions triggered by JavaScript display changes and should help with the "grey screen" issue for modals.

3.  **Enhanced Error/Loading Messages**:
    * The `fetchCSVData` function now provides more detailed error messages directly into the table if fetching or parsing fails, including a reminder about CORS if running locally.
    * The `parseCSV` includes more `console.warn` messages if it encounters empty CSVs or malformed lines, which can help you debug your CSV files if needed.
    * The generic "No \[list type] data found..." message in `renderTable` is more informative.

**To Address the "Movies Tab Appears Blank" Issue:**

* **Check your Movie CSV:**
    * Does it have data?
    * **Ideally, add a header row with just "Title" as the content of cell A1.** This is the most reliable way for the parser to work.
    * If it's headerless, ensure there's one movie title per line.
* **Test with Local Server:** Remember to use a local web server (like `python -m http.server`) when testing the HTML file on your computer. This is crucial for the CSV data to load from Google Sheets due to browser CORS security.
* **Check Browser Console:** When you test (either in Canvas preview or with your local server), open the browser's Developer Console (usually F12, then click "Console"). Look for any red error messages. These will provide vital clues if:
    * The CSV links are incorrect or not publicly accessible.
    * There are CORS errors (especially if not using a local server).
    * There are JavaScript errors during parsing or rendering.

The update attempts to make the movie list handling more flexible, but providing a "Title" header in your Movie CSV is the best way to ensure correct pa
